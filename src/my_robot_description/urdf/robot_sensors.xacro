<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">



  <!-- LiDAR -->
  
  <joint name="lidar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="lidar_link"/>
    <origin xyz="${lidar_x} ${lidar_y} ${lidar_z}" rpy="0.0 0.0 0.0"/>
  </joint>
  
  <link name="lidar_link">
    <visual>
      <geometry>
        <cylinder radius="0.035" length="0.041"/>
      </geometry>
      <material name="dark_grey">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.035" length="0.041"/>
      </geometry>
    </collision>
    <xacro:cylinder_inertia m="${lidar_mass}" r="0.035" h="0.041"/>
  </link>



  <!-- Camera (RealSense D435) -->
  
  <joint name="camera_joint" type="fixed">
    <parent link="base_link"/>
    <child link="camera_link"/>
    <origin xyz="${camera_x} ${camera_y} ${camera_z}" rpy="0.0 0.0 0.0"/>
  </joint>
  
  <link name="camera_link">
    <visual>
      <geometry>
        <box size="0.025 0.090 0.025"/>
      </geometry>
      <material name="blue">
        <color rgba="0.0 0.2 0.6 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.025 0.090 0.025"/>
      </geometry>
    </collision>
    <xacro:box_inertia m="${camera_mass}" x="0.025" y="0.090" z="0.025"/>
  </link>
  
  <!--
    ⚠️ camera_optical_frame:
    ROS 카메라 규약에서 optical frame은:
      Z+ = 전방 (바라보는 방향)
      X+ = 오른쪽
      Y+ = 아래
      
    이것은 로봇 좌표계(X+=전방)와 다름!
    → 별도 frame을 만들어서 -90° 회전!
    → realsense2_camera 드라이버가 이걸 자동으로 발행하지만 시뮬에서는 직접 정의해야 할 수 있음
  -->
  
  <joint name="camera_optical_joint" type="fixed">
    <parent link="camera_link"/>
    <child link="camera_optical_frame"/>
    <origin xyz="0.0 0.0 0.0" rpy="${-pi/2} 0.0 ${-pi/2}"/>
    <!--
      rpy 변환:
        Roll = -π/2: Y→Z 변환
        Yaw  = -π/2: X→Y 변환
        결과: 로봇좌표 → 카메라 광학 좌표
    -->
  </joint>
  
  <!-- 가상 Link: 좌표 변환용, 물리적 실체 없음 -->
  <link name="camera_optical_frame"/>



  <!-- IMU (BNO055) -->
  
  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <origin xyz="${imu_x} ${imu_y} ${imu_z}" rpy="0.0 0.0 0.0"/>
  </joint>
  
  <link name="imu_link">
    <visual>
      <geometry>
        <box size="0.027 0.020 0.004"/>
      </geometry>
      <material name="dark_grey">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.027 0.020 0.004"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${imu_mass}"/>
      <inertia ixx="1e-7" ixy="0.0" ixz="0.0"
               iyy="1e-7" iyz="0.0"
               izz="1e-7"/>
      <!--
        IMU는 10g으로 극히 가벼움
        최소값 1e-7로 설정 (Gazebo 에러 방지)
      -->
    </inertial>
  </link>

</robot>